<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cocktails</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      a {
        text-align: center;
        font-size: 20px;
        color: rgb(243, 0, 122);
      }
      .container {
        max-width: 1000px;
      }
      img {
        max-width: 100%;
        display: block;
        width: 300px;
      }
      #modalWindow {
        position: absolute;
        width: 60%;
        left: 20%; /*(100%-width)/2*/
        top: 20%;
        background: white;
        visibility: hidden;
        border: 1px solid black;
      }
      svg {
        position: absolute;
        cursor: pointer;
        top: 5px;
        right: 1%;
        width: 20px;
        height: 20px;
        visibility: none;
      }
      path {
        fill: rgb(122, 0, 91);
      }
      h3 {
        text-align: center;
        color: rgb(243, 0, 122);
      }
    </style>
  </head>
  <body>
    <div id="app" class="container mt-5">
      <!--mt - margin-top-->
      <form onsubmit="getPhotos(event)" class="input-group" id="form">
        <!--getData funkcija iššaukiama submit'inus formą-->
        <!--input-group klasė sugrupuoja kartu formos elementus-->
        <input
          type="text"
          id="search"
          class="form-control"
          placeholder="Enter the name of a drink"
        />
        <!--paieškos laukelis-->
        <button class="btn btn-warning">Search</button>
      </form>
      <div class="text-center row">
        <button id="lucky" class="btn btn-success mt-2" onclick="random(event)">
          I'm lucky
        </button>
      </div>

      <div id="result" class="mt-5"></div>
      <!--kur bus atvaizduojamas rezultatas-->
    </div>
    <div id="modalWindow" class="d-flex justify-content-around">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-x-square-fill"
        viewBox="0 0 16 16"
        onclick="getPhotos(event)"
      >
        <path
          d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm3.354 4.646L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 1 1 .708-.708z"
        />
      </svg>
      <div class="popUpWindow"></div>
    </div>

    <script>
      // --------------------------------------------------------------------Kintamieji---------------------------------------------------------------------
      const popUp = document.querySelector(".popUpWindow");
      const form = document.querySelector("form");
      const lucky = document.getElementById("lucky");
      const modal = document.getElementById("modalWindow");
      // --------------------------------------------------------------------Gaunamos foto---------------------------------------------------------------------
      function getPhotos(e) {
        e.preventDefault();
        modal.style.visibility = "hidden";
        const value = document.getElementById("search").value;
        fetch(
          `https://www.thecocktaildb.com/api/json/v1/1/search.php?s=${value}`
        )
          .then((resp) => resp.json())
          .then((resp) => {
            const result = document.getElementById("result");
            if (!resp.drinks)
              return (result.innerHTML = `<div class="alert alert-warning">Result not found</div>`);

            let html = `<div class="row">`;

            resp.drinks.map((data) => {
              html += `<div class="col-4">
                                      <a href="#" onclick="getDetails(event, ${data.idDrink})">
                                      <img src="${data.strDrinkThumb}" alt="${data.strDrink}"/>
                                    </a>
                                      <h3>${data.strDrink}</h3>
                                      </div>`;
            });
            html += `</div>`;
            result.innerHTML = html;
            form.style.visibility = "visible";
            lucky.style.visibility = "visible";
          });
      }

      // --------------------------------------------------------------------Gaunamos kokteilio detalės---------------------------------------------------------------------
      function getDetails(e, id) {
        e.preventDefault();
        fetch(`https://www.thecocktaildb.com/api/json/v1/1/lookup.php?i=${id}`)
          .then((resp) => resp.json())
          .then((resp) => {
            const data = resp.drinks[0];
            let ingredients = "";
            for (let i = 1; i <= 15; i++) {
              if (data["strIngredient" + i])
                ingredients += `<li>${data["strIngredient" + i]} ${
                  data["strMeasure" + i] ? data["strMeasure" + i] : ""
                }</li>`;
            }
            modal.style.visibility = "visible";
            addHTML(data, ingredients);
            form.style.visibility = "hidden";
          });
      }

      let alcoData;

      async function random(e) {
        lucky.style.visibility = "hidden";
        form.style.visibility = "hidden";
        modal.style.visibility = "visible";
        let data = await fetch(
          "https://www.thecocktaildb.com/api/json/v1/1/random.php"
        );
        data = await data.json();
        data = data.drinks[0];
        modal.classList.remove("d-flex");
        let ingredients = "";
        for (let i = 1; i <= 15; i++) {
          if (data["strIngredient" + i])
            ingredients += `<li>${data["strIngredient" + i]} ${
              data["strMeasure" + i] ? data["strMeasure" + i] : ""
            }</li>`;
        }
        addHTML(data, ingredients);
        alcoData = data.strAlcoholic;
      }

      function addHTML(data, ingredients) {
        popUp.innerHTML = `
        <div class="container m-3">
        <h3>${data.strDrink}</h3>
        <div class="container d-flex justify-content-center gap-3 mb-3">
        <a href="#" onclick="alcoType(event)">${data.strAlcoholic}</a>
            <a href="#">${data.strCategory}</a>
            <a href="#">${data.strGlass}</a>
          </div>
          <div class="container d-flex justify-content-center mb-3 mt-3">
            <div class="col-6 d-flex justify-content-center">
        <img src="${data.strDrinkThumb}" alt="${data.strDrink}"/>
      </div>
        <div class="col-6 d-flex flex-column align-items-start">
                <h4>Ingredients:</h4>
                  <ul>
                    ${ingredients}
                    </ul>
                    <h4">Preparation:</h4>
              <p>${data.strInstructions}</p>
                </div>
            </div>
      </div>
            `;
      }

      async function alcoType(e) {
        let data = await fetch(
          "https://www.thecocktaildb.com/api/json/v1/1/filter.php?a=" + alcoData
        );
        data = await data.json();
        data = data.drinks;
        popUp.innerHTML = `
        <div id="row" class="d-flex flex-wrap m-2 gap-2 justify-content-center"></div>
        
        `;
        for (const value of data) {
          document.getElementById(
            "row"
          ).innerHTML += `<div class="col-3 m-2 d-flex justify-content-between flex-column">
              
                <h3 style="font-size:20px">${value.strDrink}</h3>
                <img src="${value.strDrinkThumb}">
              
              </div>`;
        }
      }
    </script>
  </body>
</html>
